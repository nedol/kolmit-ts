<script lang="ts">
  let deferredPrompt = null;
  let showButton = false;

  // –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞
  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault(); // –±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ-–ø–æ–∫–∞–∑
    deferredPrompt = e;
    showButton = true;
  });

  async function installApp() {
    if (!deferredPrompt) return;

    deferredPrompt.prompt(); // –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    const result = await deferredPrompt.userChoice;
    console.log("–£—Å—Ç–∞–Ω–æ–≤–∫–∞:", result.outcome); // accepted / dismissed

    deferredPrompt = null;
    showButton = false;
  }
</script>

{#if showButton}
  <button
    on:click={installApp}
    class="add-btn"
    aria-label="–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"
  >
    üì≤ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
  </button>
{/if}

<style>
  .add-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 16px;
    font-size: 16px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    z-index: 1000;
  }

  .add-btn:hover {
    background: #0056b3;
  }
</style>
